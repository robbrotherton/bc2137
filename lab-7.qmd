# Lab 7: Data preparation & analysis {.unnumbered}

### Goals

- Read the data you need into R
- Select required variables
- Filter the data based on completeness (and any other criteria)
- Compute any required variables (scale means, number of items missing, etc)
- Compute your ANOVA

<!-- ## Data wrangling, description, and visualization -->

```{r}
library(anesr)
library(tidyverse)
data(timeseries_2020)

ci <- function(x) {
  qt(0.975, df = length(x) - 1) * sqrt( var(x) / length(x))
}

my_data <- timeseries_2020 |> 
  haven::zap_labels() |> 
  select(trust = V201237, 
         party = V201018,
         experience = V202568)

my_data_summary <- my_data |> 
  filter(if_all(everything(), ~ . >= 0)) |> 
  mutate(party = case_when(
    party == 1 ~ "Democratic",
    party == 2 ~ "Republican",
    # party == 4 ~ "None/Independent",
    TRUE ~ NA
  )) |> 
  mutate(experience = case_when(
    experience == 1 ~ "Yes",
    experience == 2 ~ "No",
    TRUE ~ NA
  )) |> 
  summarise(mean = mean(trust), 
            n = n(),
            ci = ci(trust),
            .by = c(party, experience)) |> 
  drop_na()


ggplot(my_data_summary, aes(x = party, y = mean, group = experience, fill = experience)) +
  geom_col(position = position_dodge()) +
  geom_errorbar(aes(ymax = mean + ci, ymin = mean - ci), position = position_dodge(width = 0.9), width = 0.3) +
  coord_cartesian(ylim = c(1, 5))


summary(aov(trust ~ party * experience, data = my_data))

```

